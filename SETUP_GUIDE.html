<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.27">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>CaptureExpert Setup Guide</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="SETUP_GUIDE_files/libs/clipboard/clipboard.min.js"></script>
<script src="SETUP_GUIDE_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="SETUP_GUIDE_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="SETUP_GUIDE_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="SETUP_GUIDE_files/libs/quarto-html/popper.min.js"></script>
<script src="SETUP_GUIDE_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="SETUP_GUIDE_files/libs/quarto-html/anchor.min.js"></script>
<link href="SETUP_GUIDE_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="SETUP_GUIDE_files/libs/quarto-html/quarto-syntax-highlighting-ed96de9b727972fe78a7b5d16c58bf87.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="SETUP_GUIDE_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="SETUP_GUIDE_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="SETUP_GUIDE_files/libs/bootstrap/bootstrap-9e3ffae467580fdb927a41352e75a2e0.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#captureexpert-setup-guide" id="toc-captureexpert-setup-guide" class="nav-link active" data-scroll-target="#captureexpert-setup-guide">CaptureExpert Setup Guide</a>
  <ul class="collapse">
  <li><a href="#hardware-required" id="toc-hardware-required" class="nav-link" data-scroll-target="#hardware-required">Hardware Required</a></li>
  <li><a href="#install-dependencies" id="toc-install-dependencies" class="nav-link" data-scroll-target="#install-dependencies">1. Install Dependencies</a>
  <ul class="collapse">
  <li><a href="#python-environment" id="toc-python-environment" class="nav-link" data-scroll-target="#python-environment">Python Environment</a></li>
  <li><a href="#windows-specific-notes" id="toc-windows-specific-notes" class="nav-link" data-scroll-target="#windows-specific-notes">Windows-Specific Notes</a></li>
  </ul></li>
  <li><a href="#connect-the-usb-webcams" id="toc-connect-the-usb-webcams" class="nav-link" data-scroll-target="#connect-the-usb-webcams">2. Connect the USB Webcams</a>
  <ul class="collapse">
  <li><a href="#finding-the-correct-device-indices" id="toc-finding-the-correct-device-indices" class="nav-link" data-scroll-target="#finding-the-correct-device-indices">Finding the correct device indices</a></li>
  <li><a href="#macos" id="toc-macos" class="nav-link" data-scroll-target="#macos">macOS</a></li>
  </ul></li>
  <li><a href="#connect-the-gopro-cameras" id="toc-connect-the-gopro-cameras" class="nav-link" data-scroll-target="#connect-the-gopro-cameras">3. Connect the GoPro Cameras</a>
  <ul class="collapse">
  <li><a href="#enable-wifi-on-each-gopro" id="toc-enable-wifi-on-each-gopro" class="nav-link" data-scroll-target="#enable-wifi-on-each-gopro">3.1 Enable WiFi on each GoPro</a></li>
  <li><a href="#plug-in-2-usb-wifi-adapters" id="toc-plug-in-2-usb-wifi-adapters" class="nav-link" data-scroll-target="#plug-in-2-usb-wifi-adapters">3.2 Plug in 2 USB WiFi adapters</a></li>
  <li><a href="#find-adapter-names-on-windows" id="toc-find-adapter-names-on-windows" class="nav-link" data-scroll-target="#find-adapter-names-on-windows">3.3 Find adapter names on Windows</a></li>
  <li><a href="#connect-each-adapter-to-a-gopro-wifi-network" id="toc-connect-each-adapter-to-a-gopro-wifi-network" class="nav-link" data-scroll-target="#connect-each-adapter-to-a-gopro-wifi-network">3.4 Connect each adapter to a GoPro WiFi network</a></li>
  <li><a href="#important-routing-for-multiple-gopros" id="toc-important-routing-for-multiple-gopros" class="nav-link" data-scroll-target="#important-routing-for-multiple-gopros">3.5 Important: Routing for multiple GoPros</a></li>
  <li><a href="#verify-settings.json" id="toc-verify-settings.json" class="nav-link" data-scroll-target="#verify-settings.json">3.6 Verify settings.json</a></li>
  <li><a href="#macos-1" id="toc-macos-1" class="nav-link" data-scroll-target="#macos-1">macOS</a></li>
  </ul></li>
  <li><a href="#connect-the-polar-h10-heart-rate-strap" id="toc-connect-the-polar-h10-heart-rate-strap" class="nav-link" data-scroll-target="#connect-the-polar-h10-heart-rate-strap">4. Connect the Polar H10 Heart Rate Strap</a>
  <ul class="collapse">
  <li><a href="#steps" id="toc-steps" class="nav-link" data-scroll-target="#steps">Steps</a></li>
  <li><a href="#windows-specific-notes-1" id="toc-windows-specific-notes-1" class="nav-link" data-scroll-target="#windows-specific-notes-1">Windows-Specific Notes</a></li>
  <li><a href="#optional-enable-ecg" id="toc-optional-enable-ecg" class="nav-link" data-scroll-target="#optional-enable-ecg">Optional: Enable ECG</a></li>
  </ul></li>
  <li><a href="#verify-everything-with-calibration-mode" id="toc-verify-everything-with-calibration-mode" class="nav-link" data-scroll-target="#verify-everything-with-calibration-mode">5. Verify Everything with Calibration Mode</a></li>
  <li><a href="#run-an-experiment" id="toc-run-an-experiment" class="nav-link" data-scroll-target="#run-an-experiment">6. Run an Experiment</a></li>
  <li><a href="#post-processing-gopro-lens-correction" id="toc-post-processing-gopro-lens-correction" class="nav-link" data-scroll-target="#post-processing-gopro-lens-correction">7. Post-Processing: GoPro Lens Correction</a></li>
  <li><a href="#output-files" id="toc-output-files" class="nav-link" data-scroll-target="#output-files">Output Files</a></li>
  <li><a href="#troubleshooting" id="toc-troubleshooting" class="nav-link" data-scroll-target="#troubleshooting">Troubleshooting</a>
  <ul class="collapse">
  <li><a href="#usb-webcams" id="toc-usb-webcams" class="nav-link" data-scroll-target="#usb-webcams">USB Webcams</a></li>
  <li><a href="#gopro-cameras" id="toc-gopro-cameras" class="nav-link" data-scroll-target="#gopro-cameras">GoPro Cameras</a></li>
  <li><a href="#polar-h10" id="toc-polar-h10" class="nav-link" data-scroll-target="#polar-h10">Polar H10</a></li>
  <li><a href="#general" id="toc-general" class="nav-link" data-scroll-target="#general">General</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">CaptureExpert Setup Guide</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="captureexpert-setup-guide" class="level1">
<h1>CaptureExpert Setup Guide</h1>
<p>This guide walks through connecting all hardware devices and verifying they work before running an experiment. The primary target platform is <strong>Windows 11</strong>, with macOS notes included where relevant.</p>
<hr>
<section id="hardware-required" class="level2">
<h2 class="anchored" data-anchor-id="hardware-required">Hardware Required</h2>
<ul>
<li><strong>2 USB Logitech webcams</strong> (any Logitech USB webcam that supports 1080p/30fps)</li>
<li><strong>2 GoPro cameras</strong> (Hero 7 Silver or Hero 5 Session) with charged batteries and SD cards inserted</li>
<li><strong>2 USB WiFi adapters</strong> (one per GoPro, for wireless control)</li>
<li><strong>1 Polar H10 heart rate strap</strong> with chest band</li>
<li><strong>Windows 11 PC</strong> with available USB ports and Bluetooth</li>
</ul>
<hr>
</section>
<section id="install-dependencies" class="level2">
<h2 class="anchored" data-anchor-id="install-dependencies">1. Install Dependencies</h2>
<section id="python-environment" class="level3">
<h3 class="anchored" data-anchor-id="python-environment">Python Environment</h3>
<p>Ensure Python 3.8+ is installed. Then install dependencies:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install <span class="at">-r</span> requirements.txt</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This installs: <code>opencv-python</code>, <code>numpy</code>, <code>goprocam</code>, <code>bleak</code>, and <code>pytest</code>.</p>
</section>
<section id="windows-specific-notes" class="level3">
<h3 class="anchored" data-anchor-id="windows-specific-notes">Windows-Specific Notes</h3>
<ul>
<li><strong>Visual C++ Redistributable</strong>: OpenCV requires the Visual C++ Redistributable. If you get DLL errors when importing <code>cv2</code>, download and install the latest <a href="https://learn.microsoft.com/en-us/cpp/windows/latest-supported-vc-redist">Visual C++ Redistributable</a> from Microsoft.</li>
<li><strong>Bluetooth drivers</strong>: Ensure your PC’s Bluetooth adapter has up-to-date drivers (check Device Manager &gt; Bluetooth). The <code>bleak</code> library requires Windows 10 version 1709 (Fall Creators Update) or later.</li>
</ul>
<hr>
</section>
</section>
<section id="connect-the-usb-webcams" class="level2">
<h2 class="anchored" data-anchor-id="connect-the-usb-webcams">2. Connect the USB Webcams</h2>
<ol type="1">
<li>Plug both Logitech webcams into USB ports on your PC. Avoid USB hubs if possible – connect directly to the PC’s USB ports for reliable bandwidth.</li>
<li>The first webcam plugged in is typically assigned <strong>device index 0</strong>, the second <strong>device index 1</strong>. These indices are configured in <code>settings.json</code> under the <code>cameras</code> section.</li>
<li>Windows should automatically install drivers for Logitech webcams. To verify Windows recognises the cameras, open <strong>Device Manager</strong> and check under <strong>Cameras</strong> or <strong>Imaging devices</strong> – you should see both webcams listed.</li>
</ol>
<section id="finding-the-correct-device-indices" class="level3">
<h3 class="anchored" data-anchor-id="finding-the-correct-device-indices">Finding the correct device indices</h3>
<p>If you’re unsure which index maps to which webcam, test in Python:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cv2</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Try index 0</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>cap <span class="op">=</span> cv2.VideoCapture(<span class="dv">0</span>, cv2.CAP_DSHOW)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> cap.isOpened():</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    ret, frame <span class="op">=</span> cap.read()</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Index 0: </span><span class="sc">{</span>frame<span class="sc">.</span>shape <span class="cf">if</span> ret <span class="cf">else</span> <span class="st">'no frame'</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    cap.release()</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Try index 1</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>cap <span class="op">=</span> cv2.VideoCapture(<span class="dv">1</span>, cv2.CAP_DSHOW)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> cap.isOpened():</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    ret, frame <span class="op">=</span> cap.read()</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Index 1: </span><span class="sc">{</span>frame<span class="sc">.</span>shape <span class="cf">if</span> ret <span class="cf">else</span> <span class="st">'no frame'</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    cap.release()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<blockquote class="blockquote">
<p><strong>Note</strong>: The code automatically uses the DirectShow (<code>CAP_DSHOW</code>) backend on Windows for reliable USB camera access. If you test manually in Python on Windows, always include <code>cv2.CAP_DSHOW</code> as the second argument.</p>
</blockquote>
<p>If the indices don’t match the expected front/side positions, swap the <code>device_index</code> values in <code>settings.json</code>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="er">"cameras":</span> <span class="ot">[</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">{</span><span class="dt">"id"</span><span class="fu">:</span> <span class="st">"usb_0"</span><span class="fu">,</span> <span class="dt">"name"</span><span class="fu">:</span> <span class="st">"Logitech Webcam 1"</span><span class="fu">,</span> <span class="dt">"device_index"</span><span class="fu">:</span> <span class="dv">0</span><span class="fu">,</span> <span class="er">...</span><span class="fu">}</span><span class="ot">,</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">{</span><span class="dt">"id"</span><span class="fu">:</span> <span class="st">"usb_1"</span><span class="fu">,</span> <span class="dt">"name"</span><span class="fu">:</span> <span class="st">"Logitech Webcam 2"</span><span class="fu">,</span> <span class="dt">"device_index"</span><span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span> <span class="er">...</span><span class="fu">}</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="ot">]</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="macos" class="level3">
<h3 class="anchored" data-anchor-id="macos">macOS</h3>
<p>On macOS, open <strong>System Settings &gt; Privacy &amp; Security &gt; Camera</strong> and confirm your terminal app has camera access. The code will auto-detect the correct backend on macOS (no DirectShow needed).</p>
<hr>
</section>
</section>
<section id="connect-the-gopro-cameras" class="level2">
<h2 class="anchored" data-anchor-id="connect-the-gopro-cameras">3. Connect the GoPro Cameras</h2>
<p>Each GoPro is controlled over WiFi. Each camera needs its own <strong>dedicated USB WiFi adapter</strong> because each adapter connects to a different GoPro’s WiFi network.</p>
<section id="enable-wifi-on-each-gopro" class="level3">
<h3 class="anchored" data-anchor-id="enable-wifi-on-each-gopro">3.1 Enable WiFi on each GoPro</h3>
<p><strong>Hero 7 Silver</strong>: Swipe down on the touchscreen and tap <strong>Connections &gt; Wireless Connections &gt; On</strong>. Note each camera’s WiFi network name (SSID) and password (shown on the camera screen).</p>
<p><strong>Hero 5 Session</strong>: Hold the Info/Wireless button to enable WiFi. The SSID and password can be found in the camera’s settings menu.</p>
</section>
<section id="plug-in-2-usb-wifi-adapters" class="level3">
<h3 class="anchored" data-anchor-id="plug-in-2-usb-wifi-adapters">3.2 Plug in 2 USB WiFi adapters</h3>
<p>Plug both USB WiFi adapters into available USB ports on your PC. Windows will recognise them as additional Wi-Fi adapters. Each will appear in <strong>Settings &gt; Network &amp; Internet &gt; Wi-Fi</strong> and in <strong>Device Manager &gt; Network adapters</strong>.</p>
</section>
<section id="find-adapter-names-on-windows" class="level3">
<h3 class="anchored" data-anchor-id="find-adapter-names-on-windows">3.3 Find adapter names on Windows</h3>
<p>Open PowerShell or Command Prompt and run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4"><pre class="sourceCode powershell code-with-copy"><code class="sourceCode powershell"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>netsh wlan show interfaces</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This lists all WiFi interfaces. Each USB WiFi adapter will appear with a name like <code>Wi-Fi 2</code>, <code>Wi-Fi 3</code>, etc. The built-in WiFi card is typically <code>Wi-Fi</code>. Note the adapter names – these go in the <code>wifi_interface</code> field in <code>settings.json</code>.</p>
</section>
<section id="connect-each-adapter-to-a-gopro-wifi-network" class="level3">
<h3 class="anchored" data-anchor-id="connect-each-adapter-to-a-gopro-wifi-network">3.4 Connect each adapter to a GoPro WiFi network</h3>
<p><strong>Option A – Using Windows Settings (recommended for first-time setup)</strong>:</p>
<ol type="1">
<li>Open <strong>Settings &gt; Network &amp; Internet &gt; Wi-Fi</strong>.</li>
<li>Click on the specific adapter (e.g.&nbsp;“Wi-Fi 2”) and connect it to GoPro #1’s WiFi network.</li>
<li>Click on the other adapter (e.g.&nbsp;“Wi-Fi 3”) and connect it to GoPro #2’s WiFi network.</li>
</ol>
<blockquote class="blockquote">
<p><strong>Tip</strong>: In Windows 11, if you have multiple WiFi adapters, you can manage them individually via <strong>Settings &gt; Network &amp; Internet &gt; Advanced network settings</strong>. Click on each adapter to see which network it’s connected to.</p>
</blockquote>
<p><strong>Option B – Using the command line</strong>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5"><pre class="sourceCode powershell code-with-copy"><code class="sourceCode powershell"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>netsh wlan connect name<span class="op">=</span><span class="st">"GP-Hero7-XXXX"</span> interface<span class="op">=</span><span class="st">"Wi-Fi 2"</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>netsh wlan connect name<span class="op">=</span><span class="st">"GP-Hero7-YYYY"</span> interface<span class="op">=</span><span class="st">"Wi-Fi 3"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>You may need to create WiFi profiles first if the networks aren’t remembered:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6"><pre class="sourceCode powershell code-with-copy"><code class="sourceCode powershell"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>netsh wlan add profile filename<span class="op">=</span><span class="st">"gopro1_profile.xml"</span> interface<span class="op">=</span><span class="st">"Wi-Fi 2"</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>netsh wlan add profile filename<span class="op">=</span><span class="st">"gopro2_profile.xml"</span> interface<span class="op">=</span><span class="st">"Wi-Fi 3"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="important-routing-for-multiple-gopros" class="level3">
<h3 class="anchored" data-anchor-id="important-routing-for-multiple-gopros">3.5 Important: Routing for multiple GoPros</h3>
<p>Both GoPro cameras use the same IP address (<code>10.5.5.9</code>) on their respective WiFi networks. When two USB WiFi adapters are connected to two different GoPros, Windows has two routes to <code>10.5.5.9</code> and will only use one by default.</p>
<p>To ensure both GoPros are reachable, you need to set different <strong>route metrics</strong> so Windows knows which adapter reaches which GoPro:</p>
<ol type="1">
<li>Open <strong>Control Panel &gt; Network and Sharing Center &gt; Change adapter settings</strong>.</li>
<li>Right-click the first USB WiFi adapter (connected to GoPro #1) &gt; <strong>Properties</strong> &gt; <strong>Internet Protocol Version 4 (TCP/IPv4)</strong> &gt; <strong>Properties</strong> &gt; <strong>Advanced</strong>.</li>
<li>Uncheck <strong>Automatic metric</strong> and set <strong>Interface metric</strong> to <code>10</code>.</li>
<li>Repeat for the second USB WiFi adapter and set its metric to <code>20</code>.</li>
</ol>
<p>Alternatively, from an <strong>elevated (Administrator) PowerShell</strong>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb7"><pre class="sourceCode powershell code-with-copy"><code class="sourceCode powershell"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check current routes to see interface indices</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>route print <span class="dv">10.5</span><span class="op">.</span><span class="dv">5</span><span class="op">.*</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Set metrics (replace IF_INDEX with the actual interface index from route print)</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>netsh interface ip <span class="fu">set</span> interface <span class="st">"Wi-Fi 2"</span> metric<span class="op">=</span><span class="dv">10</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="dt">netsh</span> interface ip <span class="fu">set</span> interface <span class="st">"Wi-Fi 3"</span> metric<span class="op">=</span><span class="dv">20</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<blockquote class="blockquote">
<p><strong>Note</strong>: With different metrics, the goprocam library will connect to the GoPro accessible via the lower-metric adapter first. The code uses threaded parallel connections, so both GoPros should connect, but the routing configuration is essential for reliable dual-GoPro operation.</p>
</blockquote>
</section>
<section id="verify-settings.json" class="level3">
<h3 class="anchored" data-anchor-id="verify-settings.json">3.6 Verify settings.json</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb8"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="er">"gopros":</span> <span class="ot">[</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">{</span><span class="dt">"id"</span><span class="fu">:</span> <span class="st">"gopro_hero7_1"</span><span class="fu">,</span> <span class="dt">"name"</span><span class="fu">:</span> <span class="st">"GoPro Hero 7 Silver #1"</span><span class="fu">,</span> <span class="dt">"model"</span><span class="fu">:</span> <span class="st">"hero7_silver"</span><span class="fu">,</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>   <span class="dt">"wifi_interface"</span><span class="fu">:</span> <span class="st">"Wi-Fi 2"</span><span class="fu">,</span> <span class="dt">"ip_address"</span><span class="fu">:</span> <span class="st">"10.5.5.9"</span><span class="fu">,</span> <span class="dt">"enabled"</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">}</span><span class="ot">,</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">{</span><span class="dt">"id"</span><span class="fu">:</span> <span class="st">"gopro_hero7_2"</span><span class="fu">,</span> <span class="dt">"name"</span><span class="fu">:</span> <span class="st">"GoPro Hero 7 Silver #2"</span><span class="fu">,</span> <span class="dt">"model"</span><span class="fu">:</span> <span class="st">"hero7_silver"</span><span class="fu">,</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>   <span class="dt">"wifi_interface"</span><span class="fu">:</span> <span class="st">"Wi-Fi 3"</span><span class="fu">,</span> <span class="dt">"ip_address"</span><span class="fu">:</span> <span class="st">"10.5.5.9"</span><span class="fu">,</span> <span class="dt">"enabled"</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">}</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="ot">]</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Replace <code>"Wi-Fi 2"</code> and <code>"Wi-Fi 3"</code> with the actual adapter names shown by <code>netsh wlan show interfaces</code>.</p>
</section>
<section id="macos-1" class="level3">
<h3 class="anchored" data-anchor-id="macos-1">macOS</h3>
<p>On macOS, USB WiFi adapters are assigned interface names like <code>en1</code>, <code>en2</code>. Find them with:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">networksetup</span> <span class="at">-listallhardwareports</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Connect to GoPro networks with:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb10"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="ex">networksetup</span> <span class="at">-setairportnetwork</span> en1 <span class="st">"GP-Hero7-XXXX"</span> <span class="st">"password1"</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="ex">networksetup</span> <span class="at">-setairportnetwork</span> en2 <span class="st">"GP-Hero7-YYYY"</span> <span class="st">"password2"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<hr>
</section>
</section>
<section id="connect-the-polar-h10-heart-rate-strap" class="level2">
<h2 class="anchored" data-anchor-id="connect-the-polar-h10-heart-rate-strap">4. Connect the Polar H10 Heart Rate Strap</h2>
<p>The Polar H10 connects over Bluetooth Low Energy (BLE). No pairing through Windows Bluetooth settings is needed – the <code>bleak</code> library handles the connection directly.</p>
<section id="steps" class="level3">
<h3 class="anchored" data-anchor-id="steps">Steps</h3>
<ol type="1">
<li><p><strong>Moisten the electrode pads</strong> on the inside of the chest strap and put it on. The strap must detect skin contact to broadcast a signal.</p></li>
<li><p><strong>Ensure Bluetooth is enabled</strong> on your PC. Check in <strong>Settings &gt; Bluetooth &amp; devices</strong> – the toggle should be On.</p></li>
<li><p>In <code>settings.json</code>, heart rate is already enabled:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb11"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="er">"heart_rate":</span> <span class="fu">{</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"enabled"</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"device_address"</span><span class="fu">:</span> <span class="kw">null</span><span class="fu">,</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"ecg_enabled"</span><span class="fu">:</span> <span class="kw">false</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>With <code>device_address</code> set to <code>null</code>, the software will automatically scan for any nearby Polar H10. If you have multiple Polar H10 straps nearby and need to target a specific one, set <code>device_address</code> to its BLE address (e.g.&nbsp;<code>"A0:9E:1A:XX:XX:XX"</code>).</p></li>
<li><p><strong>Close other Bluetooth apps</strong>: Make sure no other app (Polar Beat, Polar Flow, etc.) is currently connected to the strap. BLE only allows one active connection at a time.</p></li>
</ol>
</section>
<section id="windows-specific-notes-1" class="level3">
<h3 class="anchored" data-anchor-id="windows-specific-notes-1">Windows-Specific Notes</h3>
<ul>
<li>The <code>bleak</code> library uses the Windows Bluetooth stack directly. No special drivers or pairing steps are needed.</li>
<li>If BLE scanning fails, ensure your Bluetooth adapter supports BLE 4.0+. Check <strong>Device Manager &gt; Bluetooth</strong> for adapter details.</li>
<li>Some antivirus software can block BLE scanning. If the Polar H10 is not found, try temporarily disabling real-time protection.</li>
<li>If using a USB Bluetooth adapter (rather than built-in), ensure its drivers are installed and it appears in Device Manager.</li>
</ul>
</section>
<section id="optional-enable-ecg" class="level3">
<h3 class="anchored" data-anchor-id="optional-enable-ecg">Optional: Enable ECG</h3>
<p>Set <code>"ecg_enabled": true</code> in <code>settings.json</code> to stream raw ECG data at 130 Hz alongside the standard heart rate. This produces an additional CSV file in the output. ECG requires the Polar H10 specifically (other Polar models do not support this feature).</p>
<hr>
</section>
</section>
<section id="verify-everything-with-calibration-mode" class="level2">
<h2 class="anchored" data-anchor-id="verify-everything-with-calibration-mode">5. Verify Everything with Calibration Mode</h2>
<p>Before running an experiment, use the built-in calibration check to confirm all devices are connected and working:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb12"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> main.py <span class="at">--calibrate</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This will:</p>
<ol type="1">
<li><strong>Test each USB webcam</strong> – opens the device, captures a test frame, and reports the resolution</li>
<li><strong>Test each GoPro</strong> – connects over WiFi, reads battery level and model info</li>
<li><strong>Test the Polar H10</strong> – scans via BLE, connects, reads battery, and records 3 seconds of heart rate data to confirm signal</li>
</ol>
<p>You’ll see output like:</p>
<pre><code>============================================================
  CALIBRATION TOOL - Device Connectivity Check
============================================================

--- USB Cameras (2) ---
  Logitech Webcam 1: PASS - connected, frame captured (1920x1080)
  Logitech Webcam 2: PASS - connected, frame captured (1920x1080)

--- GoPro Cameras (2) ---
  GoPro Hero 7 Silver #1: PASS - connected, model=hero7_silver, battery=85%
  GoPro Hero 7 Silver #2: PASS - connected, model=hero7_silver, battery=72%

--- Polar H10 Heart Rate Monitor ---
  Polar H10: PASS - connected, battery=90%, HR signal detected

============================================================
  CALIBRATION SUMMARY
============================================================
  ...
  Results: 5/5 passed
  Overall: PASS - All devices ready
============================================================</code></pre>
<p>If any device shows <strong>FAIL</strong>, check the troubleshooting table below.</p>
<hr>
</section>
<section id="run-an-experiment" class="level2">
<h2 class="anchored" data-anchor-id="run-an-experiment">6. Run an Experiment</h2>
<p>Once calibration passes, run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb14"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> main.py</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Or with a custom config file:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb15"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> main.py <span class="at">--config</span> my_settings.json</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>The experiment runs through three phases:</p>
<ol type="1">
<li><strong>Calibration</strong> (10s) – GoPros connect, webcams capture frames, HR recording begins</li>
<li><strong>Recording</strong> (60s) – GoPros record video to SD cards, webcams capture at ~30fps, HR continues</li>
<li><strong>Post-Recording</strong> (indefinite) – GoPro battery status displayed, press <strong>Ctrl+C</strong> to finish</li>
</ol>
<p>On Ctrl+C or phase completion, the system saves all data and disconnects cleanly.</p>
<hr>
</section>
<section id="post-processing-gopro-lens-correction" class="level2">
<h2 class="anchored" data-anchor-id="post-processing-gopro-lens-correction">7. Post-Processing: GoPro Lens Correction</h2>
<p>GoPro footage is saved to the cameras’ SD cards. After downloading the video files, you can apply barrel distortion correction:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb16"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Process all .mp4 files in a directory</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> main.py <span class="at">--undistort</span> /path/to/gopro/videos/</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Process a single file</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> main.py <span class="at">--undistort</span> /path/to/clip.mp4</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>On Windows, use backslashes or forward slashes:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb17"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> main.py <span class="at">--undistort</span> C:<span class="dt">\U</span>sers<span class="dt">\Y</span>ourName<span class="dt">\V</span>ideos<span class="dt">\g</span>opro<span class="dt">\</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>python main.py <span class="at">--undistort</span> C:/Users/YourName/Videos/gopro/</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Output files are saved alongside originals with an <code>_undistorted</code> suffix.</p>
<hr>
</section>
<section id="output-files" class="level2">
<h2 class="anchored" data-anchor-id="output-files">Output Files</h2>
<p>After an experiment, the <code>output/</code> directory contains:</p>
<pre><code>output/
  frames/
    calibration/
      usb_0_000001.jpg
      usb_1_000001.jpg
      ...
    recording/
      usb_0_000001.jpg
      ...
  heart_rate_YYYYMMDD_HHMMSS.csv
  ecg_YYYYMMDD_HHMMSS.csv          (only if ecg_enabled was true)</code></pre>
<ul>
<li><strong>Frame images</strong>: captured from the USB webcams during each phase</li>
<li><strong>heart_rate CSV</strong>: timestamp, BPM, RR intervals, sensor contact status, and phase label</li>
<li><strong>ECG CSV</strong>: timestamp, phase, and raw ECG microvolts (if enabled)</li>
</ul>
<p>GoPro video must be downloaded separately from the cameras’ SD cards.</p>
<hr>
</section>
<section id="troubleshooting" class="level2">
<h2 class="anchored" data-anchor-id="troubleshooting">Troubleshooting</h2>
<section id="usb-webcams" class="level3">
<h3 class="anchored" data-anchor-id="usb-webcams">USB Webcams</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Problem</th>
<th>Solution</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Camera not detected</td>
<td>Check <strong>Device Manager &gt; Cameras</strong> – the webcam should be listed. Try a different USB port. Avoid USB hubs.</td>
</tr>
<tr class="even">
<td>Black frames or wrong resolution</td>
<td>Some webcams need a moment to adjust exposure. The first few frames may be dark. If resolution doesn’t match, check the webcam supports 1920x1080 – lower <code>resolution</code> in <code>settings.json</code> if needed (e.g.&nbsp;<code>[1280, 720]</code>).</td>
</tr>
<tr class="odd">
<td><code>cv2.VideoCapture</code> fails silently</td>
<td>On Windows, the code uses the DirectShow backend (<code>CAP_DSHOW</code>). If issues persist, try updating the webcam drivers from the Logitech website.</td>
</tr>
<tr class="even">
<td>Wrong camera on wrong index</td>
<td>Swap <code>device_index</code> values in <code>settings.json</code>, or unplug both cameras and plug them in one at a time to identify which gets index 0 vs 1.</td>
</tr>
</tbody>
</table>
</section>
<section id="gopro-cameras" class="level3">
<h3 class="anchored" data-anchor-id="gopro-cameras">GoPro Cameras</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Problem</th>
<th>Solution</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Can’t connect to GoPro WiFi</td>
<td>Ensure the GoPro’s WiFi is enabled and broadcasting. The WiFi LED should be blinking. Check that the USB WiFi adapter is working in Device Manager.</td>
</tr>
<tr class="even">
<td>WiFi adapter not connecting</td>
<td>Run <code>netsh wlan show interfaces</code> to verify the adapter is detected. Try connecting via Windows Settings manually first.</td>
</tr>
<tr class="odd">
<td>Only one GoPro connects</td>
<td>Both GoPros use IP <code>10.5.5.9</code>. Ensure route metrics are configured differently for each WiFi adapter (see Section 3.5).</td>
</tr>
<tr class="even">
<td>GoPro disconnects during experiment</td>
<td>GoPros drop WiFi if they don’t receive periodic keep-alive signals. The software sends these automatically every 2.5 seconds. Check WiFi adapter signal strength and move adapters closer to the cameras.</td>
</tr>
<tr class="odd">
<td><code>goprocam</code> connection timeout</td>
<td>Verify the WiFi adapter is connected to the GoPro’s network by pinging: <code>ping 10.5.5.9</code>. If no response, reconnect the WiFi adapter to the GoPro network.</td>
</tr>
</tbody>
</table>
</section>
<section id="polar-h10" class="level3">
<h3 class="anchored" data-anchor-id="polar-h10">Polar H10</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Problem</th>
<th>Solution</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Not found during scan</td>
<td>Make sure the strap is on your body with moistened electrodes. The H10 only broadcasts BLE when it detects skin contact. Also ensure no other app is connected to the strap.</td>
</tr>
<tr class="even">
<td>Bluetooth permission error</td>
<td>Ensure Bluetooth is enabled in <strong>Settings &gt; Bluetooth &amp; devices</strong>. Some antivirus software blocks BLE – try disabling real-time protection temporarily.</td>
</tr>
<tr class="odd">
<td>Connection drops</td>
<td>Ensure the PC’s Bluetooth adapter supports BLE 4.0+. Stay within Bluetooth range (~10m). Avoid interference from other Bluetooth devices.</td>
</tr>
</tbody>
</table>
</section>
<section id="general" class="level3">
<h3 class="anchored" data-anchor-id="general">General</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Problem</th>
<th>Solution</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>ModuleNotFoundError</code> on import</td>
<td>Run <code>pip install -r requirements.txt</code> to install all dependencies.</td>
</tr>
<tr class="even">
<td>Permission errors writing output</td>
<td>Ensure the <code>output/</code> directory path in <code>settings.json</code> is writable. Use an absolute path if the default <code>./output</code> causes issues.</td>
</tr>
<tr class="odd">
<td>Ctrl+C doesn’t stop cleanly</td>
<td>On Windows, Ctrl+C in the terminal should trigger KeyboardInterrupt. If the process hangs, use Ctrl+Break or close the terminal window. The teardown handler will attempt to disconnect all devices.</td>
</tr>
</tbody>
</table>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>